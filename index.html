<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="ZeroJi&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="ZeroJi&#39;s Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ZeroJi&#39;s Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>ZeroJi's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ZeroJi's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/28/hexo搭建个人站点/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZeroJi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/icon.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZeroJi's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/28/hexo搭建个人站点/" itemprop="url">hexo搭建个人站点</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-28T14:54:06+08:00">
                2018-04-28
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2018-04-28T16:16:46+08:00">
                2018-04-28
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index">
                    <span itemprop="name">Blog</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="安装前提"><a href="#安装前提" class="headerlink" title="安装前提"></a>安装前提</h1><p>首先需要具备以下应用程序</p>
<ul>
<li>Node.js</li>
<li>Git</li>
</ul>
<p>接下来使用 <code>npm</code> 安装 <code>Hexo</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g hexo-cli</span><br></pre></td></tr></table></figure>
<h1 id="建站"><a href="#建站" class="headerlink" title="建站"></a>建站</h1><p>安装 <code>Hexo</code> 后, 执行以下命令, <code>Hexo</code> 会在指定文件夹中创建相关文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ hexo init &lt;folder&gt;</span><br><span class="line">$ cd &lt;folder&gt; </span><br><span class="line">$ cnpm install</span><br></pre></td></tr></table></figure>
<p>文件目录如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── _config.yml // Hexo 配置文件</span><br><span class="line">├── package.json // npm 配置文件</span><br><span class="line">├── scaffolds // 模版文件夹</span><br><span class="line">├── source // 资源文件夹</span><br><span class="line">|   └── _posts // 文章文件夹</span><br><span class="line">└── themes // 主题文件夹</span><br></pre></td></tr></table></figure>
<p><a href="https://hexo.io/zh-cn/docs/configuration.html" target="_blank" rel="noopener">_config.yml 文件配置</a></p>
<h1 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h1><h2 id="init"><a href="#init" class="headerlink" title="init"></a>init</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo init [folder]</span><br></pre></td></tr></table></figure>
<p>新建一个网站, <code>folder</code> 若为空, 默认在当前文件夹下.</p>
<h2 id="new"><a href="#new" class="headerlink" title="new"></a>new</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new [layout] &lt;title&gt;</span><br></pre></td></tr></table></figure>
<p>新建一篇文章. 如果没有设置 <code>layout</code> 的话, 默认使用 <code>_config.yml</code> 中的 <code>default_layout</code> 参数代替. 如果标题包含空格的话, 请使用引号括起来. 生成的文件名由 <code>_config.yml</code> 中的 <code>new_post_name</code> 参数决定.</p>
<p><code>layout</code> 参数值</p>
<ul>
<li><code>post</code>  生成路径:  <code>source/_posts</code></li>
<li><code>page</code>  生成路径:  <code>source</code></li>
<li><code>draft</code>  生成路径:  <code>source/_drafts</code></li>
</ul>
<h2 id="generate"><a href="#generate" class="headerlink" title="generate"></a>generate</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>默认生成在根目录的 <code>public</code> 文件夹中, 命令可简写成:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo g</span><br></pre></td></tr></table></figure>
<p>选项</p>
<ul>
<li><code>-d</code>, <code>--deploy</code>  文件生成后立即部署网站</li>
<li><code>-w</code>, <code>--watch</code> 监视文件变动</li>
</ul>
<h2 id="server"><a href="#server" class="headerlink" title="server"></a>server</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>启动服务器</p>
<h2 id="clean"><a href="#clean" class="headerlink" title="clean"></a>clean</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo clean</span><br></pre></td></tr></table></figure>
<p>清除缓存文件 <code>db.json</code> 和已生成的静态文件 <code>public</code></p>
<h1 id="迁移"><a href="#迁移" class="headerlink" title="迁移"></a>迁移</h1><h2 id="Jekyll"><a href="#Jekyll" class="headerlink" title="Jekyll"></a>Jekyll</h2><p>把 <code>_posts</code> 文件夹内的所有文件复制到 <code>source/_posts</code> 文件夹, 并在 <code>_config.yml</code> 中修改 new_post_name 参数.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new_post_name: :year-:month-:day-:title.md</span><br></pre></td></tr></table></figure>
<h1 id="Front-matter"><a href="#Front-matter" class="headerlink" title="Front-matter"></a>Front-matter</h1><p><code>Front-matter</code> 是文件最上方以 <code>---</code> 分隔的区域, 用于指定个别文件的变量, 比如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">layout: post // 布局 post page draft</span><br><span class="line">title: hexo搭建个人站点 // 标题</span><br><span class="line">date: 2018-04-28 14:54:06 // 建立日期 默认为文件简历时间</span><br><span class="line">updated: 2018-04-28 14:54:06 // 更新日期 默认为文件更新日期</span><br><span class="line">comments: true // 开启文章的评论功能 默认为 true</span><br><span class="line">tags: // 标签</span><br><span class="line">- hexo</span><br><span class="line">categories: // 标签</span><br><span class="line">- Blog</span><br><span class="line">---</span><br></pre></td></tr></table></figure>
<h1 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h1><h2 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h2><p>安装 <code>hexo-deployer-git</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>
<p>必须先在 <code>_config.yml</code> 中修改参数, 例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: &lt;repository url&gt; // 库（Repository）地址</span><br><span class="line">  branch: [branch] // 分支名称</span><br><span class="line">  message: [message] // 自定义提交信息 (默认为 Site updated: &#123;&#123; now(&apos;YYYY-MM-DD HH:mm:ss&apos;) &#125;&#125;)</span><br></pre></td></tr></table></figure>
<p>然后执行以下两条命令都可达到生成静态文件并部署的目的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ hexo d -g</span><br><span class="line">$ hexo g -d</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/09/12/iOS_多语言本地化(国际化)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZeroJi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/icon.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZeroJi's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/12/iOS_多语言本地化(国际化)/" itemprop="url">iOS_多语言本地化(国际化)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-12T06:20:00+08:00">
                2016-09-12
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2018-04-28T17:10:12+08:00">
                2018-04-28
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="多语言本地化-国际化"><a href="#多语言本地化-国际化" class="headerlink" title="多语言本地化(国际化)"></a>多语言本地化(国际化)</h3><ol>
<li>根据系统语言切换应用语言</li>
<li>应用内部切换语言</li>
</ol>
<p>因为内部切换语言只需修改获取的系统语言的信息, 所以在这里我们只讨论根据系统语言切换应用版本.</p>
<h4 id="添加需要的语言"><a href="#添加需要的语言" class="headerlink" title="添加需要的语言"></a>添加需要的语言</h4><ol>
<li>点击项目 </li>
<li>选择 <code>PROJECT</code> 下的本项目</li>
<li>选中上方的 <code>Info</code></li>
<li>找到 <code>Localization</code> 并点击 <code>+</code> 号添加要支持的语言</li>
</ol>
<h4 id="国际化应用名称"><a href="#国际化应用名称" class="headerlink" title="国际化应用名称"></a>国际化应用名称</h4><ol>
<li>选择 <code>Info.plist</code> 配置文件</li>
<li>点击加号添加 <code>Application has localized display name</code> 并设置值为 <code>YES</code></li>
<li><code>command</code> + <code>n</code> 创建 <code>String Files</code>, 取名为 <code>InfoPlist</code></li>
<li>点击 <code>InfoPlist.strings</code> 文件, <code>command</code> + <code>alt</code> + <code>1</code> 调出右侧工具栏</li>
<li>点击 <code>Localization</code> 完成配置后, 将需要的语言打钩.</li>
<li>点开 <code>InfoPlist.strings</code> 文件前的小三角, 选择需要的语言添加 <code>CFBundleDisplayName =&quot;MultiLanguageTest&quot;;</code> (<code>=</code> 后面的为对应的翻译)</li>
</ol>
<h4 id="国际化文字"><a href="#国际化文字" class="headerlink" title="国际化文字"></a>国际化文字</h4><ol>
<li>创建名称为 <code>Localizable</code> 的 <code>String Files</code></li>
<li>同上在工具栏勾选需要的语言</li>
<li>将语言翻译后加入各语言的文件 如 <code>&quot;buy&quot; = &quot;购买&quot;;</code></li>
<li>最后在需要使用文字的地方使用 <code>NSLocalizedString(@&quot;buy&quot;, nil);</code> 方法(第一个参数为配置的文字, 第二个参数无视即可)</li>
</ol>
<h4 id="多人开发"><a href="#多人开发" class="headerlink" title="多人开发"></a>多人开发</h4><p>对于多人开发来说, 每个人负责一些模块, 那么如果用同一个文字配置文件很容易造成代码合并冲突, 所以需要根据各自的模块选取命名不同的文字配置文件.</p>
<p>唯一与上面所说的不同的是, 不要再使用 <code>NSLocalizedString(@&quot;buy&quot;, nil);</code> 方法, 而要使用 <code>NSLocalizedStringFromTable(@&quot;OMG&quot;, @&quot;LabelText&quot;, nil);</code> 方法(第二个参数为文字配置文件名).</p>
<h4 id="模拟器切换系统语言"><a href="#模拟器切换系统语言" class="headerlink" title="模拟器切换系统语言"></a>模拟器切换系统语言</h4><p>一.  直接在模拟器中切换</p>
<p>二.</p>
<ol>
<li>点击暂停按钮右边的项目按钮</li>
<li>选择 <code>Edit Scheme...</code></li>
<li>选择弹出窗口中左边的 <code>Run</code></li>
<li>选择 <code>Option</code></li>
<li>点击 <code>Application Language</code> 选择语言</li>
</ol>
<p>然后运行应用即可.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/06/24/iOS_ApplyPay/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZeroJi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/icon.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZeroJi's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/24/iOS_ApplyPay/" itemprop="url">iOS_ApplyPay</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-24T02:00:00+08:00">
                2016-06-24
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2018-04-28T17:03:02+08:00">
                2018-04-28
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="ApplyPay"><a href="#ApplyPay" class="headerlink" title="ApplyPay"></a>ApplyPay</h3><p><code>ApplyPay</code> 是苹果推出的支付方式, 意在创建更加快捷方便的支付.</p>
<p><code>ApplyPay</code> 需要后台前台相互协作, 而在文章中, 我们只涉及怎么做好前端.</p>
<h3 id="ApplyPay-环境配置"><a href="#ApplyPay-环境配置" class="headerlink" title="ApplyPay 环境配置"></a>ApplyPay 环境配置</h3><p><code>ApplyPay</code> 的使用需要开发者证书和商用ID, 这些需要在苹果开发者设置中创建.</p>
<h4 id="开发者证书的获取"><a href="#开发者证书的获取" class="headerlink" title="开发者证书的获取"></a>开发者证书的获取</h4><p>首先打开应用程序 <code>KeyChain(钥匙串访问)</code>, 在左上角钥匙串访问-&gt;证书助理中, 选择 <code>从证书颁发机构求证书</code>.</p>
<p>在 <code>用户电子邮件地址</code> 一栏填写你的开发者账号, <code>常用名称</code> 随便填写, <code>CA电子邮件地址</code> 一栏不需要填写. 然后选择 <code>储存到磁盘</code>.</p>
<p>选择路径储存证书请求文件.</p>
<p>这个文件在下面会用到.</p>
<h4 id="商用ID申请"><a href="#商用ID申请" class="headerlink" title="商用ID申请"></a>商用ID申请</h4><p>登录 <a href="https://developer.apple.com/" target="_blank" rel="noopener">https://developer.apple.com/</a>, 选择 <code>Account</code> 选项, 填写开发者账号密码进入设置界面.</p>
<ol>
<li>在设置页面, 选择 <code>Certificates，Identifiers&amp;Profiles</code></li>
<li>在 <code>Identifiers</code> 下, 选择 Merchant IDs`</li>
<li>在右上角点击 <code>+</code> 按钮</li>
<li>在 <code>Description</code> 栏 输入相应信息, 点击 <code>Continue</code></li>
<li>浏览下配置参数, 点击 `Register’</li>
<li>点击 ‘Done` 完成</li>
</ol>
<p>为你的ID标明配置一个证书</p>
<ol>
<li>在设置页面, 选择 <code>Certificates，Identifiers&amp;Profiles</code></li>
<li>在 <code>Identifiers</code> 下, 选择 Merchant IDs`</li>
<li>选择刚才创建的 <code>ID</code>, 点击 <code>Edit</code></li>
<li>点击 <code>Create certificate</code>, 点击 <code>Conitnue</code></li>
<li>点击 <code>Choose File</code>, 选择之前创建的证书请求, 点击 <code>Generate</code></li>
<li>点击 <code>Download</code> 下载证书, 点击 <code>Done</code> 完成</li>
</ol>
<p>这样, 证书生成完毕.</p>
<h3 id="配置App使其支持ApplyPay"><a href="#配置App使其支持ApplyPay" class="headerlink" title="配置App使其支持ApplyPay"></a>配置App使其支持ApplyPay</h3><p>为了在 <code>Xcode</code> 中启用 <code>Apply Pay</code>, 打开 App 工程文件的 <code>Capabilities</code> 面板. 在 <code>Apple Pay</code> 这行将开关按钮设置为 <code>ON</code>, 接着选择 App 需要使用的 ID 标示.</p>
<h3 id="ApplyPay代码"><a href="#ApplyPay代码" class="headerlink" title="ApplyPay代码"></a>ApplyPay代码</h3><p>在 <code>ViewController</code> 中引入两个类</p>
<ol>
<li><code>PassKit/PassKit.h</code> 用户绑定银行卡的信息</li>
<li><code>PassKit/PKPaymentAuthorizationViewController.h</code> <code>Apply Pay</code> 的展示控件</li>
</ol>
<p>创建一个属性用于储存模拟卡片, 并且懒加载模拟卡片</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 支持的卡片类型 */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *supportNewworks;</span><br><span class="line"></span><br><span class="line"> (<span class="built_in">NSArray</span> *)supportNewworks</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_supportNewworks) &#123;</span><br><span class="line">        <span class="comment">// 此处只是模拟卡片, 真实卡片需要获取</span></span><br><span class="line">        <span class="keyword">self</span>.supportNewworks = [<span class="built_in">NSArray</span> arrayWithObjects:PKPaymentNetworkAmex, PKPaymentNetworkMasterCard, PKPaymentNetworkVisa, PKPaymentNetworkChinaUnionPay, <span class="literal">nil</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> _supportNewworks;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在使用 <code>Apply Pay</code> 之前, 我们需要判断设备是否支持 <code>Apply Pay</code>, 是否有绑定支持 <code>Apply Pay</code> 的卡片</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 是否能使用 Apply Pay</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)canMakePay</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 判断当前设备是否支持 Apply Pay</span></span><br><span class="line">    <span class="keyword">if</span> (![PKPaymentAuthorizationViewController canMakePayments]) &#123;</span><br><span class="line">        <span class="built_in">UIAlertController</span> *alert = [<span class="built_in">UIAlertController</span> alertControllerWithTitle:<span class="string">@"警告"</span> message:<span class="string">@"当前设备部支持 Apply Pay"</span> preferredStyle:<span class="built_in">UIAlertControllerStyleActionSheet</span>];</span><br><span class="line">        <span class="built_in">UIAlertAction</span> *action = [<span class="built_in">UIAlertAction</span> actionWithTitle:<span class="string">@"确定"</span> style:<span class="built_in">UIAlertActionStyleCancel</span> handler:^(<span class="built_in">UIAlertAction</span> * _Nonnull action) &#123;</span><br><span class="line">            [alert dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">        &#125;];</span><br><span class="line">        [alert addAction:action];</span><br><span class="line">        [<span class="keyword">self</span> presentViewController:alert animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">#warning 当真机调试时 如果这里canMakePaymentsUsingNetworks不能通过，表示手机的钱包（wallet）还没有开通，开通后，添加一张卡，就可以使用</span></span><br><span class="line">    <span class="comment">// 判断是否有绑定支持的卡片</span></span><br><span class="line">    <span class="keyword">if</span> (![PKPaymentAuthorizationViewController canMakePaymentsUsingNetworks: <span class="keyword">self</span>.supportNewworks]) &#123;</span><br><span class="line">        <span class="built_in">UIAlertController</span> *alert = [<span class="built_in">UIAlertController</span> alertControllerWithTitle:<span class="string">@"警告"</span> message:<span class="string">@"没有绑定任何支持类型的卡片, 请绑定"</span> preferredStyle:<span class="built_in">UIAlertControllerStyleActionSheet</span>];</span><br><span class="line">        <span class="built_in">UIAlertAction</span> *action = [<span class="built_in">UIAlertAction</span> actionWithTitle:<span class="string">@"确定"</span> style:<span class="built_in">UIAlertActionStyleCancel</span> handler:^(<span class="built_in">UIAlertAction</span> * _Nonnull action) &#123;</span><br><span class="line">            [alert dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">        &#125;];</span><br><span class="line">        [alert addAction:action];</span><br><span class="line">        [<span class="keyword">self</span> presentViewController:alert animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置支付请求方法 </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置支付请求</span></span><br><span class="line">- (<span class="keyword">void</span>)setupRequest</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建请求</span></span><br><span class="line">    PKPaymentRequest *request = [[PKPaymentRequest alloc] init];</span><br><span class="line">    <span class="comment">// 创建商品</span></span><br><span class="line">    PKPaymentSummaryItem *item = [PKPaymentSummaryItem summaryItemWithLabel:<span class="string">@"诺心食品有限公司"</span> amount:[<span class="built_in">NSDecimalNumber</span> decimalNumberWithString:<span class="string">@"1"</span>]];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置请求</span></span><br><span class="line">    request.paymentSummaryItems = @[item]; <span class="comment">// 商品信息</span></span><br><span class="line">    request.countryCode = <span class="string">@"CN"</span>; <span class="comment">// 国家</span></span><br><span class="line">    request.currencyCode = <span class="string">@"CNY"</span>; <span class="comment">// 金额显示格式</span></span><br><span class="line">    request.supportedNetworks = _supportNewworks; <span class="comment">// 支持的支付方式</span></span><br><span class="line">    request.merchantIdentifier = <span class="string">@"merchant.lecakeApplePay"</span>;</span><br><span class="line">    request.merchantCapabilities = PKMerchantCapability3DS|PKMerchantCapabilityEMV; <span class="comment">// 支持的交易处理协议</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建支付界面</span></span><br><span class="line">    PKPaymentAuthorizationViewController *paymentSheet = [[PKPaymentAuthorizationViewController alloc] initWithPaymentRequest:request];</span><br><span class="line">    <span class="keyword">if</span> (paymentSheet) &#123;</span><br><span class="line">        [<span class="keyword">self</span> presentViewController:paymentSheet animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">        <span class="comment">// 设置代理</span></span><br><span class="line">        paymentSheet.delegate = <span class="keyword">self</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接受 <code>PKPaymentAuthorizationViewControllerDelegate</code> 代理, 实现代理方法.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 支付成功后, 苹果服务器返回信息回调</span></span><br><span class="line">- (<span class="keyword">void</span>)paymentAuthorizationViewController:(PKPaymentAuthorizationViewController *)controller didAuthorizePayment:(PKPayment *)payment completion:(<span class="keyword">void</span> (^)(PKPaymentAuthorizationStatus))completion</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 支付凭证, 发给服务器验证支付是否真实有效</span></span><br><span class="line">    <span class="comment">//PKPaymentToken *paymentToken = payment.token;</span></span><br><span class="line">    <span class="comment">//PKContact *billingContact = payment.billingContact; //账单信息</span></span><br><span class="line">    <span class="comment">//PKContact *shippingContact = payment.shippingContact; //送货信息</span></span><br><span class="line">    <span class="comment">//PKShippingMethod *shippingMethod = payment.shippingMethod; //商品信息</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 等待服务器返回结果后, 再进行系统 block 调用</span></span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">3</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        <span class="comment">// 模拟服务器通信</span></span><br><span class="line">        completion(PKPaymentAuthorizationStatusSuccess);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 支付完成回调</span></span><br><span class="line">- (<span class="keyword">void</span>)paymentAuthorizationViewControllerDidFinish:(PKPaymentAuthorizationViewController *)controller</span><br><span class="line">&#123;</span><br><span class="line">    [controller dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后添加一个按钮响应支付</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span> canMakePay]) &#123;</span><br><span class="line">        <span class="built_in">CGRect</span> scrrenFrame = [<span class="built_in">UIScreen</span> mainScreen].bounds;</span><br><span class="line">        <span class="built_in">CGFloat</span> scrrenW = scrrenFrame.size.width;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">UIButton</span> *payButton = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">        payButton.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, scrrenW - <span class="number">200</span>, <span class="number">50</span>);</span><br><span class="line">        [payButton setTitle:<span class="string">@"Apply Pay"</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        [payButton setTitleColor:[<span class="built_in">UIColor</span> darkGrayColor] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        [payButton setBackgroundColor:[<span class="built_in">UIColor</span> blackColor]];</span><br><span class="line">        [payButton addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(setupRequest) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">        [<span class="keyword">self</span>.view addSubview:payButton];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>至此, 一个简单的 <code>ApplyPayDemo</code> 就此完成, github上有我的代码, 地址为<a href="https://github.com/qq1216137037/ApplyPayDemo" target="_blank" rel="noopener">https://github.com/qq1216137037/ApplyPayDemo</a>.</p>
<p>参考资料: </p>
<ol>
<li><a href="http://www.open-open.com/lib/view/open1422324034345.html" target="_blank" rel="noopener">Apple Pay编程指南</a></li>
<li><a href="http://www.jianshu.com/p/9ec40755ba35" target="_blank" rel="noopener">iOS App集成Apple Pay 编程指南（中国版）</a></li>
<li><a href="http://www.th7.cn/Program/IOS/201603/771495.shtml" target="_blank" rel="noopener">IOS-APP提交上架流程</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/06/24/iOS离线模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZeroJi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/icon.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZeroJi's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/24/iOS离线模式/" itemprop="url">iOS离线模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-24T02:00:00+08:00">
                2016-06-24
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2018-04-28T17:02:59+08:00">
                2018-04-28
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="离线模式"><a href="#离线模式" class="headerlink" title="离线模式"></a>离线模式</h3><p>这几天公司有新需求, 当网络异常或没有网络时显示上次显示过的页面. 我将这个需求剖析开来, 分成两个问题:</p>
<ol>
<li>完成图片缓存</li>
<li>完成数据本地存储</li>
</ol>
<p>接下来的开发就围绕这两个问题进行解决.</p>
<h3 id="图片缓存"><a href="#图片缓存" class="headerlink" title="图片缓存"></a>图片缓存</h3><p>说起图片时, 我第一个是想到了 <code>SDWebImage</code>, 但因为之前没有深入研究过, 做了不少的傻事. 例如: 将 <code>SDWebImage</code> 再次封装成一个延展, 手动实现图片的本地缓存, 手动搜索并判断图片的存在, 手动提取本地图片等. 但是后来发现, 只要调用 <code>sd_setImage:</code> 这个方法, 本地会出现两张同名的图片, 实在令人费解. 经过测试后确认, 以上的一切 <code>SDWebImage</code> 已经帮我们做好了. 仅仅只要调用 <code>sd</code> 开头的设置图片方法, 就能自动进行本地缓存.</p>
<p><code>SDWebImage</code> 缓存图片的原理, 在我个人的理解上是: 显示占位图-&gt; 从内存中查找图片 -&gt; 从磁盘中查找图片 -&gt; 根据 <code>url</code> 下载图片 -&gt; 显示图片. 当从内存或磁盘中找到图片时, 直接略过后面步骤显示图片.</p>
<p>当然, 手动图片缓存图片也有它的可取之处, 灵活性很高, 可以自行判断是否缓存图片, 自定义图片缓存地址, 最大并发数, 图片缓存策略等.</p>
<p>本地缓存类 <code>SDWebImage</code> 中的 <code>SDImageCache</code>. <code>SDImageCache</code> 是个单例类, 使用以下代码获取. 这样图片缓存路径为沙盒路径下的<code>Library/Caches/default</code>.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 直接获取默认对象 */</span></span><br><span class="line">+ (SDImageCache *)sharedImageCache;</span><br></pre></td></tr></table></figure>
<p>当然, 自定义缓存空间也是可行的.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 在沙盒的cache目录下创建一个指定名字的缓存空间(文件夹) */</span></span><br><span class="line">- (instanstype)initWithNamespace:(<span class="built_in">NSString</span> *)ns;</span><br></pre></td></tr></table></figure>
<p>存储图片到内存和磁盘上</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 在内存和磁盘上存储一个图片(key参数是图片的唯一标识符) */</span></span><br><span class="line">- (<span class="keyword">void</span>)storeImage:(<span class="built_in">UIImage</span> *)image forkey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line"><span class="comment">/** 缓存一个图片到内存, 并设置是否缓存到磁盘上 */</span></span><br><span class="line">- (<span class="keyword">void</span>)storeImage:(<span class="built_in">UIImage</span> *)image forKey:(<span class="built_in">NSString</span> *)key toDisk:(<span class="built_in">BOOL</span>)toDisk;</span><br></pre></td></tr></table></figure>
<p>查找图片并且获取指定 <code>key</code> 的图片</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 异步在磁盘上查找指定 key 的图片, 完成后回调 Block */</span></span><br><span class="line">- (<span class="built_in">NSOperation</span> *)queryDiskCacheForKey:(<span class="built_in">NSString</span> *)key done:(SDWebImageQueryCompleteBlock)doneBlock;</span><br><span class="line"><span class="comment">/** 从内存获取指定 key 的图片 */</span></span><br><span class="line">- (<span class="built_in">UIImage</span> *)imageFromMemoryCacheForKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line"><span class="comment">/** 从磁盘获取指定 key 的图片 */</span></span><br><span class="line">- (<span class="built_in">UIImage</span> *)imageFromDiskCacheForKey:(<span class="built_in">NSString</span> *)key;</span><br></pre></td></tr></table></figure>
<h3 id="数据本地存储"><a href="#数据本地存储" class="headerlink" title="数据本地存储"></a>数据本地存储</h3><p>数据存储是个极其简单的事情, 无非是将 <code>JSON</code> 数据本地化, <code>plist</code> 文件或者数据库都能实现. </p>
<p>因为图方便, 我使用 <code>plist</code> 文件进行存储. 但也遇到了一些问题, 就是在使用 <code>NSUserDefault</code> 存储数据时, 出现了 <code>Attempt to set a non-property-list object</code>的问题. 按字面意思翻译为”不能设置一个没在属性列表中的对象”, 即存储类型中有非系统类型的自定义对象.</p>
<p>为了解决这个问题, 需要将对象编码为 <code>NSData</code> 类型的对象后再存储, 而提取时需要解码.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对数组进行编码并且储存数据</span></span><br><span class="line"><span class="built_in">NSData</span> *data = [<span class="built_in">NSKeyedArchiver</span> archivedDataWithRootObject:cakeModelArray];</span><br><span class="line">[[<span class="built_in">NSUserDefaults</span> standardUserDefaults] setObject:data forKey:<span class="string">@"cakeModelArray"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取数据并解码成数组</span></span><br><span class="line"><span class="built_in">NSData</span> *data = [[<span class="built_in">NSUserDefaults</span> standardUserDefaults] objectForKey: <span class="string">@"cakeModelArray"</span>];</span><br><span class="line">_cakeModelArray = [<span class="built_in">NSKeyedUnarchiver</span> unarchiveObjectWithData:data];</span><br></pre></td></tr></table></figure>
<p>本以为用了以上方法就能成功, 但是错误提示还是没有改变. 经过资料查询后, 找到问题所在: 自定义类型需要遵守 <code>NSCoding</code> 协议, 并且实现编码解码方法, 对其中的属性进行处理.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">LeCakeShopModel</span> : <span class="title">NSObject</span> &lt;<span class="title">NSCoding</span>&gt;</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>)<span class="built_in">NSString</span> *img;</span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>)<span class="built_in">NSString</span> *tag;</span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>)<span class="built_in">NSMutableArray</span> *goods;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LeCakeShopModel</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写解码方法</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithCoder:(<span class="built_in">NSCoder</span> *)aDecoder</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.img = [aDecoder decodeObjectForKey:<span class="string">@"img"</span>];</span><br><span class="line">        <span class="keyword">self</span>.tag = [aDecoder decodeObjectForKey:<span class="string">@"tag"</span>];</span><br><span class="line">        <span class="keyword">self</span>.goods = [aDecoder decodeObjectForKey:<span class="string">@"goods"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写编码方法</span></span><br><span class="line">- (<span class="keyword">void</span>)encodeWithCoder:(<span class="built_in">NSCoder</span> *)aCoder</span><br><span class="line">&#123;</span><br><span class="line">    [aCoder encodeObject:<span class="keyword">self</span>.img forKey:<span class="string">@"img"</span>];</span><br><span class="line">    [aCoder encodeObject:<span class="keyword">self</span>.tag forKey:<span class="string">@"tag"</span>];</span><br><span class="line">    [aCoder encodeObject:<span class="keyword">self</span>.goods forKey:<span class="string">@"goods"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>之前对 <code>SDWebImage</code> 框架的理解还是停留在很浅层的地方, 亦不涉及原理. 这次比较深入的使用以后, 发现 <code>SDWebImage</code> 的强大所在. 也是提醒自己, 深受推广的框架必有惊人之处.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/04/OC之引导界面/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZeroJi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/icon.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZeroJi's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/04/OC之引导界面/" itemprop="url">iOS 之引导界面</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-04T07:30:00+08:00">
                2016-05-04
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2018-04-28T17:02:56+08:00">
                2018-04-28
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>首先来说一下我对引导界面的理解, 引导界面是在启动界面后出现的视图, 就是 <code>Window</code> 的根视图控制器.</p>
<p>弹出引导界面的条件为</p>
<ol>
<li>第一次启动App</li>
<li>版本更新后第一次启动App</li>
</ol>
<p>引导界面中的视图应该为一个轮播图, 轮播图中包括一个 <code>UIPageControl</code>, 一个进入 <code>UIButton</code>, 有些引导界面还包含跳过 <code>UIButton</code>.</p>
<p>了解清楚原理后, 我们开始制作引导界面.</p>
<p>创建 <code>FirstLunchViewController</code> 继承自 <code>ViewController</code></p>
<p>在 <code>ViewDidLoad</code> 中完成大体框架.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//  设置滚动视图</span></span><br><span class="line">    [<span class="keyword">self</span> setupScrollView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置页面指示器</span></span><br><span class="line">    [<span class="keyword">self</span> setupPageControl];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置进入按钮</span></span><br><span class="line">    [<span class="keyword">self</span> setupIntoButton];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后实现方法</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  初始化滚动视图</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)setupScrollView</span><br><span class="line">&#123;</span><br><span class="line">    _scrollView = [[<span class="built_in">UIScrollView</span> alloc] initWithFrame:kScreenFrame];</span><br><span class="line">    _scrollView.pagingEnabled = <span class="literal">YES</span>;</span><br><span class="line">    _scrollView.delegate = <span class="keyword">self</span>;</span><br><span class="line">    _scrollView.contentSize = <span class="built_in">CGSizeMake</span>(kScreenW * <span class="keyword">self</span>.scrollViewArr.count, <span class="number">0</span>);</span><br><span class="line">    _scrollView.bounces = <span class="literal">NO</span>;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:_scrollView];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGFloat</span> current = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">UIView</span> *view <span class="keyword">in</span> <span class="keyword">self</span>.scrollViewArr) &#123;</span><br><span class="line">        view.frame = <span class="built_in">CGRectMake</span>(current * kScreenW, <span class="number">0</span>, kScreenW, kScreenH);</span><br><span class="line">        [_scrollView addSubview:view];</span><br><span class="line">        current++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  初始化页面指示器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)setupPageControl</span><br><span class="line">&#123;</span><br><span class="line">    _pageControl = [[<span class="built_in">UIPageControl</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, kScreenH - <span class="number">50</span>, kScreenW, <span class="number">50</span>)];</span><br><span class="line">    _pageControl.numberOfPages = <span class="keyword">self</span>.scrollViewArr.count;</span><br><span class="line">    _pageControl.pageIndicatorTintColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    _pageControl.currentPageIndicatorTintColor = [<span class="built_in">UIColor</span> darkGrayColor];</span><br><span class="line">    [_pageControl addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(pageControlValueChanged:) forControlEvents:<span class="built_in">UIControlEventValueChanged</span>];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:_pageControl];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  调整输入按钮位置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)setupIntoButton</span><br><span class="line">&#123;</span><br><span class="line">    _intoButton.center = <span class="built_in">CGPointMake</span>((<span class="keyword">self</span>.scrollViewArr.count - <span class="number">1</span>) * kScreenW + kScreenW / <span class="number">2</span>, kScreenH - <span class="number">200</span>);</span><br><span class="line">    [_intoButton addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(presentToLunchVC) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [_scrollView addSubview:_intoButton];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了使引导视图可复用, 我留了3个属性给外部设置</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 所有引导的视图 */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSArray</span> *scrollViewArr;</span><br><span class="line"><span class="comment">/** 引导界面过后推出的视图控制器 */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIViewController</span> *presentViewController;</span><br><span class="line"><span class="comment">/** 点击进入主页的按钮 */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIButton</span> *intoButton;</span><br></pre></td></tr></table></figure>
<p>最后完成各种事件</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  按钮点击事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)presentToLunchVC</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.presentViewController.transitioningDelegate = <span class="keyword">self</span>.animator;</span><br><span class="line">    <span class="keyword">self</span>.presentViewController.modalPresentationStyle = <span class="built_in">UIModalPresentationCustom</span>;</span><br><span class="line">    [<span class="keyword">self</span> presentViewController:<span class="keyword">self</span>.presentViewController animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  指示器事件</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  @param pageControl 指示器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)pageControlValueChanged:(<span class="built_in">UIPageControl</span> *)pageControl</span><br><span class="line">&#123;</span><br><span class="line">     <span class="built_in">CGFloat</span> offsetx = pageControl.currentPage;</span><br><span class="line">         <span class="keyword">self</span>.scrollView.contentOffset = <span class="built_in">CGPointMake</span>(offsetx * kScreenW, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  滚动事件</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  @param scrollView 滚动视图</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)scrollViewDidScroll:(<span class="built_in">UIScrollView</span> *)scrollView</span><br><span class="line">&#123;</span><br><span class="line">     <span class="built_in">CGFloat</span> offsetx = scrollView.contentOffset.x;</span><br><span class="line">         <span class="keyword">self</span>.pageControl.currentPage = (<span class="keyword">int</span>)(offsetx / kScreenW  + <span class="number">0.5</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>delegate</code> 为弱引用, 所以设置代理不为本控制器时, 需要定义一个属性.</p>
<p>由于系统自带的 <code>modal</code> 转场动画太过难看, 我自定义了一个转场动画类.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回负责转场的控制器对象</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">UIPresentationController</span> *)presentationControllerForPresentedViewController:(<span class="built_in">UIViewController</span> *)presented presentingViewController:(<span class="built_in">UIViewController</span> *)presenting sourceViewController:(<span class="built_in">UIViewController</span> *)source</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIPresentationController</span> *controller = [[<span class="built_in">UIPresentationController</span> alloc] initWithPresentedViewController:presented presentingViewController:presenting];</span><br><span class="line">    <span class="keyword">return</span> controller;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 只要使用了一下方法, 动画所需的所有特效以及参数都需要程序员自己设定</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 指定展现动画的控制器</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment"> - parameter presented:  被展示的控制器</span></span><br><span class="line"><span class="comment"> - parameter presenting: 推出控制器的控制器</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> - returns: 指定转场控制器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerAnimatedTransitioning</span>&gt;)animationControllerForPresentedController:(<span class="built_in">UIViewController</span> *)presented presentingController:(<span class="built_in">UIViewController</span> *)presenting sourceController:(<span class="built_in">UIViewController</span> *)source</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 指定消失动画的控制器</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment"> - parameter dismissed: 被消失的控制器</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> - returns: 指定转场控制器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerAnimatedTransitioning</span>&gt;)animationControllerForDismissedController:(<span class="built_in">UIViewController</span> *)dismissed</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UIViewControllerAnimatedTransitioning -</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  指定动画执行时长</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  @param transitionContext 上下文</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  @return 动画执行时长</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="built_in">NSTimeInterval</span>)transitionDuration:(<span class="keyword">id</span>&lt;<span class="built_in">UIViewControllerContextTransitioning</span>&gt;)transitionContext</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0.5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  每次转场都会调用的方法</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  @param transitionContext 上下文</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)animateTransition:(<span class="keyword">id</span>&lt;<span class="built_in">UIViewControllerContextTransitioning</span>&gt;)transitionContext</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 获取视图</span></span><br><span class="line">    <span class="built_in">UIView</span> *toView = [transitionContext viewForKey:<span class="built_in">UITransitionContextToViewKey</span>];</span><br><span class="line">    toView.alpha = <span class="number">0.0</span>;</span><br><span class="line">    <span class="comment">// 2. 添加视图到控制器中</span></span><br><span class="line">    [[transitionContext containerView] addSubview:toView];</span><br><span class="line">    <span class="comment">// 3. 执行动画</span></span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:[<span class="keyword">self</span> transitionDuration:transitionContext] animations:^&#123;</span><br><span class="line">        toView.alpha = <span class="number">1</span>;</span><br><span class="line">    &#125; completion:^(<span class="built_in">BOOL</span> finished) &#123;</span><br><span class="line">        <span class="comment">// 一定要告诉系统动画执行完毕, 否则会出现未知错误</span></span><br><span class="line">        [transitionContext completeTransition:<span class="literal">YES</span>];</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 <code>AppDelegate</code> 中判断是否需要使用引导界面</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#define kVersion  @<span class="meta-string">"version"</span></span></span><br><span class="line"><span class="meta">#define kIsFirstLunch  @<span class="meta-string">"firstLunch"</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// 设置window</span></span><br><span class="line">        <span class="keyword">self</span>.window = [[<span class="built_in">UIWindow</span> alloc] initWithFrame:[<span class="built_in">UIScreen</span> mainScreen].bounds];</span><br><span class="line">        <span class="keyword">self</span>.window.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">        [<span class="keyword">self</span>.window makeKeyAndVisible];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取info文件</span></span><br><span class="line">        <span class="built_in">NSDictionary</span> *infoDic = [[<span class="built_in">NSBundle</span> mainBundle] infoDictionary];</span><br><span class="line">        <span class="comment">// 获取App的版本号</span></span><br><span class="line">        <span class="built_in">NSString</span> *appVersion = [infoDic objectForKey:<span class="string">@"CFBundleShortVersionString"</span>];</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// 判断是否第一次启动, 并且App版本是否一致</span></span><br><span class="line">        <span class="built_in">UIViewController</span> *vc = <span class="literal">nil</span>;</span><br><span class="line">        <span class="keyword">if</span> ([[<span class="built_in">NSUserDefaults</span> standardUserDefaults] boolForKey:kIsFirstLunch] || [[[<span class="built_in">NSUserDefaults</span> standardUserDefaults] valueForKey:kVersion] isEqualToString: appVersion]) &#123;</span><br><span class="line">            vc = [[MainViewController alloc] init];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            [[<span class="built_in">NSUserDefaults</span> standardUserDefaults] setBool:<span class="literal">NO</span> forKey:kIsFirstLunch];</span><br><span class="line">            [[<span class="built_in">NSUserDefaults</span> standardUserDefaults] setObject:appVersion forKey:kVersion];</span><br><span class="line">            FirstLunchViewController *firstVC = [[FirstLunchViewController alloc] init];</span><br><span class="line">        </span><br><span class="line">            <span class="comment">// 设置导航视图</span></span><br><span class="line">            <span class="built_in">NSMutableArray</span> *arr = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">                <span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"deemo_icon"</span>]];</span><br><span class="line">                [arr addObject:imageView];</span><br><span class="line">            &#125;</span><br><span class="line">            firstVC.scrollViewArr = arr;</span><br><span class="line">        </span><br><span class="line">            <span class="comment">// 设置进入按钮</span></span><br><span class="line">            <span class="built_in">UIButton</span> *infoButton = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">            [infoButton setTitle:<span class="string">@"欢迎"</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">            [infoButton setTitleColor:[<span class="built_in">UIColor</span> redColor] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">            infoButton.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">40</span>);</span><br><span class="line">            firstVC.intoButton = infoButton;</span><br><span class="line">        </span><br><span class="line">            <span class="comment">// 设置主界面</span></span><br><span class="line">            firstVC.presentViewController = [[MainViewController alloc] init];</span><br><span class="line">            vc = firstVC;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置 window 根视图控制器</span></span><br><span class="line">        <span class="keyword">self</span>.window.rootViewController = vc;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/26/OC之日志本地储存/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZeroJi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/icon.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZeroJi's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/26/OC之日志本地储存/" itemprop="url">iOS 之输出日志本地存储</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-26T13:10:00+08:00">
                2016-04-26
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2018-04-28T17:02:53+08:00">
                2018-04-28
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>宏定义输出函数, 根据 <code>DEBUG</code> 开关来控制是否执行输出</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#ifdef DEBUG</span></span><br><span class="line"><span class="meta">#define LOG(fmt, ...) do &#123;                                            \</span></span><br><span class="line">    <span class="built_in">NSString</span>* file = [[<span class="built_in">NSString</span> alloc] initWithFormat:<span class="string">@"%s"</span>, __FILE__]; \</span><br><span class="line">    <span class="built_in">NSLog</span>((<span class="string">@"File:%@ Function:%s Line:%d content:"</span> fmt), [file lastPathComponent], __func__, __LINE__, <span class="meta">##__VA_ARGS__); \</span></span><br><span class="line">&#125; <span class="keyword">while</span>(<span class="number">0</span>)</span><br><span class="line"><span class="meta">#define LOG_METHOD NSLog(@<span class="meta-string">"%s"</span>, __func__)</span></span><br><span class="line"><span class="meta">#define LOG_CMETHOD NSLog(@<span class="meta-string">"%@/%@"</span>, NSStringFromClass([self class]), NSStringFromSelector(_cmd))</span></span><br><span class="line"><span class="meta">#define LOG_TRACE(x) do &#123;printf x; putchar('\n'); fflush(stdout);&#125; while (0)</span></span><br><span class="line"><span class="meta">#define LOG_APPEND NSLog(@<span class="meta-string">"------------------------------------------------------------------------------------------------应用程序关闭------------------------------------------------------------------------------------------------"</span>)</span></span><br><span class="line"><span class="meta">#else</span></span><br><span class="line"><span class="meta">#define LOG(...)</span></span><br><span class="line"><span class="meta">#define LOG_METHOD</span></span><br><span class="line"><span class="meta">#define LOG_CMETHOD</span></span><br><span class="line"><span class="meta">#define LOG_TRACE(x)</span></span><br><span class="line"><span class="meta">#define LOG_APPEND</span></span><br><span class="line"><span class="meta">#endif</span></span><br></pre></td></tr></table></figure>
<p>定义一个函数将输出信息保存到本地</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">void</span>)redirectNSLogToDocumentFolder&#123;</span><br><span class="line">    <span class="comment">// 获取Document文件所在地址</span></span><br><span class="line">    <span class="built_in">NSArray</span> *paths = <span class="built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="built_in">NSDocumentDirectory</span>, <span class="built_in">NSUserDomainMask</span>, <span class="literal">YES</span>);</span><br><span class="line">    <span class="built_in">NSString</span> *documentsDirectory = [paths objectAtIndex:<span class="number">0</span>];</span><br><span class="line">     </span><br><span class="line">    <span class="comment">// 转换时间格式</span></span><br><span class="line">    <span class="built_in">NSDateFormatter</span> *formatter = [[<span class="built_in">NSDateFormatter</span> alloc] init];</span><br><span class="line">    formatter.dateFormat = <span class="string">@"yyyy-MM-dd"</span>;</span><br><span class="line">    <span class="built_in">NSString</span> *stringDate = [formatter stringFromDate:[<span class="built_in">NSDate</span> date]];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 拼接文件名</span></span><br><span class="line">    <span class="built_in">NSString</span> *fileName =[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@.log"</span>, stringDate];</span><br><span class="line">    <span class="built_in">NSString</span> *logFilePath = [documentsDirectory stringByAppendingPathComponent:fileName];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 写入日志文件</span></span><br><span class="line">    freopen([logFilePath cStringUsingEncoding:<span class="built_in">NSASCIIStringEncoding</span>],<span class="string">"a+"</span>,stderr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>文件名称用日期命名, 输出的日志信息格式为</p>
<p>2016-04-26.log</p>
<p>2016-04-26 21:28:14.367 LogManager[50020:13135086] File:AppDelegate.m Function:-[AppDelegate application:didFinishLaunchingWithOptions:] Line:25 content:应用程序完成加载</p>
<p>方便出错时寻找BUG, 也可以在上线后, 用户提交BUG时获取日志信息, 方便修改.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/19/OC之计步器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZeroJi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/icon.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZeroJi's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/19/OC之计步器/" itemprop="url">iOS 之计步器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-19T09:30:00+08:00">
                2016-04-19
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2018-04-28T17:02:49+08:00">
                2018-04-28
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="计步器"><a href="#计步器" class="headerlink" title="计步器"></a>计步器</h2><p><code>iOS</code> 之后, 系统使用 <code>CMPedometer</code> 类调用计步器.</p>
<p>而我们可以进一步对其进行封装, 其中碰到的一些坑也会在下文一一讲述.</p>
<p>首先是创建一个类, 继承自 <code>NSObject</code>.</p>
<p>然后在 <code>.h</code> 中声明 <code>block</code> 和实例方法.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">void</span> (^UseStep) (<span class="built_in">CMPedometerData</span> * _Nullable pedometerData, <span class="built_in">NSError</span> * _Nullable error);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 根据时间计算步数 */</span></span><br><span class="line">- (<span class="keyword">void</span>)stepFromDate:(<span class="built_in">NSDate</span> * _Nonnull)startTime toDate:(<span class="built_in">NSDate</span> * _Nullable)endTime withHandler:(UseStep _Nonnull)handler;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 计算今天的步数 从0时0分0秒开始*/</span></span><br><span class="line">- (<span class="keyword">void</span>)stepFromTodayWithHandler:(UseStep _Nonnull)handler;</span><br></pre></td></tr></table></figure>
<p>然后在 <code>.m</code> 文件中添加一个类目, 并且在其中声明 <code>block</code> 属性 用 <code>copy</code> 修饰, 防止 <code>block</code> 在传输中被系统回收.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 定义为属性防止被销毁 */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) _Nonnull UseStep useStep;</span><br></pre></td></tr></table></figure>
<p>声明全局变量 <code>CMPedometer</code>, 如果此变量不为全局, 后面就会出错.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="built_in">CMPedometer</span> *pedometer = <span class="literal">nil</span>;</span><br></pre></td></tr></table></figure>
<p>之后实现声明的方法, 并且重写 <code>init</code> 方法</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">instancetype</span>)init</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">        <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">            pedometer = [[<span class="built_in">CMPedometer</span> alloc] init];</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 根据时间计算步数 核心方法*/</span></span><br><span class="line">- (<span class="keyword">void</span>)stepFromDate:(<span class="built_in">NSDate</span> * _Nonnull)startTime toDate:(<span class="built_in">NSDate</span> * _Nullable)endTime withHandler:(UseStep _Nonnull)handler</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.useStep = handler;</span><br><span class="line">    <span class="keyword">if</span> ([<span class="built_in">CMPedometer</span> isStepCountingAvailable]) &#123; <span class="comment">// 判断是否支持记步功能</span></span><br><span class="line">        <span class="keyword">if</span> (endTime) &#123;</span><br><span class="line">            [pedometer queryPedometerDataFromDate:[<span class="built_in">NSDate</span> systemTimeZoneWithDate:startTime] toDate:[<span class="built_in">NSDate</span> systemTimeZoneWithDate:endTime] withHandler:<span class="keyword">self</span>.useStep];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            [pedometer startPedometerUpdatesFromDate:[<span class="built_in">NSDate</span> systemTimeZoneWithDate:startTime] withHandler:<span class="keyword">self</span>.useStep];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="built_in">NSLog</span>(<span class="string">@"设备不支持记步功能"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 计算今天的步数 从0时0分0秒开始*/</span></span><br><span class="line">- (<span class="keyword">void</span>)stepFromTodayWithHandler:(UseStep _Nonnull)handler</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.useStep = handler;</span><br><span class="line">    <span class="built_in">NSDateFormatter</span> *formatter = [[<span class="built_in">NSDateFormatter</span> alloc] init];</span><br><span class="line">    formatter.dateFormat = <span class="string">@"yyyy-MM-dd"</span>;</span><br><span class="line">    <span class="built_in">NSString</span> *stringDate = [formatter stringFromDate:[<span class="built_in">NSDate</span> date]];</span><br><span class="line">    <span class="built_in">NSDate</span> *date = [formatter dateFromString:stringDate];</span><br><span class="line"></span><br><span class="line">    [<span class="keyword">self</span> stepFromDate:date toDate:<span class="literal">nil</span> withHandler:<span class="keyword">self</span>.useStep];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后添加一个类扩展来将生成的 <code>NSDate</code> 转换为系统时区的时间.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 转换时间为本地时区 */</span></span><br><span class="line">+ (<span class="built_in">NSDate</span> *)systemTimeZoneWithDate:(<span class="built_in">NSDate</span> *)date</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSTimeZone</span> *zone = [<span class="built_in">NSTimeZone</span> systemTimeZone];</span><br><span class="line">    <span class="built_in">NSTimeInterval</span> interval = [zone secondsFromGMTForDate:date];</span><br><span class="line">    <span class="built_in">NSDate</span> *systemTimeZoneDate = [date dateByAddingTimeInterval:(<span class="keyword">double</span>)interval];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> systemTimeZoneDate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/15/Swift使用OC第三方类库/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZeroJi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/icon.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZeroJi's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/15/Swift使用OC第三方类库/" itemprop="url">Swift OC 混编</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-15T03:05:00+08:00">
                2016-04-15
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2018-04-28T17:06:49+08:00">
                2018-04-28
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Swift-中导入-OC"><a href="#Swift-中导入-OC" class="headerlink" title="Swift 中导入 OC"></a>Swift 中导入 OC</h2><h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><p>当创建或者手动导入 <code>OC</code> 到 <code>Swift</code> 项目中的时候, <code>Xcode</code> 会自动提示是否创建桥接文件, 然后在桥接文件中添加要使用的 <code>OC</code> 头文件即可.</p>
<h4 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h4><p>如果错过了上面的方法, 可以手动创建桥接文件.</p>
<p><code>cmd</code> + <code>n</code> 创建新文件, 选择 <code>Header File</code>, 并且将其命名为 <code>xxxx-Brigding-Header.h</code>.</p>
<h4 id="写入要桥接的文件的头文件"><a href="#写入要桥接的文件的头文件" class="headerlink" title="写入要桥接的文件的头文件"></a>写入要桥接的文件的头文件</h4><p>在文件中写入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;xxxx.h&quot;</span><br></pre></td></tr></table></figure>
<p>另外需要在项目中进行配置, 指定创建的文件为桥接文件.</p>
<p>项目 -&gt; Builde Setting -&gt; Objective Bridging Header 中的值设置为 xxxx-Brigding-Header.h.</p>
<hr>
<p>完成后就可以在 <code>.Swift</code> 文件中使用 <code>OC</code> 中的类, 包括第三方类库.</p>
<h2 id="OC-中导入-Swift"><a href="#OC-中导入-Swift" class="headerlink" title="OC 中导入 Swift"></a>OC 中导入 Swift</h2><ol>
<li>在项目设置查找中输入 <code>module</code></li>
<li>找到 <code>Defines Module</code> 选项设置为 <code>YES</code></li>
<li>在要使用 <code>Swift</code> 的类中导入头文件, <code>ProductName-Swift.h</code> 其中 <code>ProductName</code> 为当前的工程名</li>
</ol>
<p>完成后即可以在 <code>OC</code> 中使用 <code>Swift</code> 类.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/13/Mac实用工具之iTerm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZeroJi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/icon.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZeroJi's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/13/Mac实用工具之iTerm/" itemprop="url">Mac实用工具之iTerm 2</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-13T09:00:00+08:00">
                2016-04-13
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2018-04-28T17:06:42+08:00">
                2018-04-28
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mac/" itemprop="url" rel="index">
                    <span itemprop="name">mac</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="iTerm2"><a href="#iTerm2" class="headerlink" title="iTerm2"></a>iTerm2</h2><p><code>iTerm 2</code> 是一个终端, 用来代替 <code>Mac</code> 自带 <code>Terminal</code>, 拥有更强大的功能. </p>
<ol>
<li>可以设置主题</li>
<li>支持画面分割</li>
<li>快捷键的支持</li>
<li>快速呼出</li>
</ol>
<p><a href="https://www.iterm2.com/" target="_blank" rel="noopener">下载地址</a></p>
<hr>
<p>将 Preferences - Profiles - Terminal - Terminal Emulation - Report Terminal Type 中的 <code>xterm</code> 改成 <code>xterm-256color</code>, 这样在 <code>Vim</code> 显示一些配色方案会好很多.</p>
<hr>
<p>快捷键如下</p>
<ul>
<li><code>cmd</code> + <code>t</code> 新建标签页</li>
<li><code>cmd</code> + <code>w</code> 关闭当前页</li>
<li><code>cmd</code> + <code>数字</code> &amp; <code>方向键</code> 切换标签页</li>
<li><code>cmd</code> + <code>Enter</code> 全屏</li>
<li><code>cmd</code> + <code>d</code> 左右分屏</li>
<li><code>cmd</code> + <code>shift</code> + <code>d</code> 上下分屏</li>
</ul>
<hr>
<p>快速呼出功能设置</p>
<p><code>cmd</code> + <code>,</code> 呼出偏好设置, 在 <code>Kyes</code> 中勾选 <code>Show/hid iTerm2 with a system-wide hotky</code> 和 其下面的选项, <code>Hotkey</code> 为呼出组合键, 下拉选项中是快速呼出界面的配置.</p>
<p>配置在 <code>Profiles</code> 中设置</p>
<h2 id="Oh-My-Zsh"><a href="#Oh-My-Zsh" class="headerlink" title="Oh My Zsh"></a>Oh My Zsh</h2><p>实用的插件, 可以方便配置酷炫的主题.</p>
<p>下载指令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh -c &quot;$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot;</span><br></pre></td></tr></table></figure>
<p>下载完毕后, 打开 <code>~</code> 目录下的 <code>.zshrc</code> 文件</p>
<p>在其中修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZSH_THEME=&quot;agnoster&quot;</span><br></pre></td></tr></table></figure>
<p>然后将偏好设置中的字体修改为 <code>12pt Anonymice Powerline</code> 既可以实现酷炫主题.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/03/Swift_二十三_访问控制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZeroJi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/icon.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZeroJi's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/03/Swift_二十三_访问控制/" itemprop="url">Swift (二十三) 访问控制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-03T05:55:00+08:00">
                2016-04-03
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2018-04-28T17:06:25+08:00">
                2018-04-28
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="访问控制"><a href="#访问控制" class="headerlink" title="访问控制"></a>访问控制</h2><ul>
<li>访问控制可以限定其他源文件或模块中的代码对你的代码的访问级别. 这个特性可以让我们隐藏代码的一些实现细节, 并且可以为其他人可以访问和使用的代码提供接口.</li>
<li>你可以明确地给单个类型(类 结构体 枚举)设置访问级别, 也可以给这些类型的属性 方法 构造器 下标等设置访问级别, 协议也可以被限定在一定的访问内使用, 包括协议里的全局常量 变量和函数.</li>
<li><code>Swift</code> 不仅提供了多种不同的访问级别, 还为某些典型场景提供了默认的访问级别, 这样就不需要我们在每段代码中都声明显式访问级别.</li>
</ul>
<h2 id="模块和源文件"><a href="#模块和源文件" class="headerlink" title="模块和源文件"></a>模块和源文件</h2><p>模块指的是独立的代码单元, 框架或应用程序会作为一个独立的模块来构建和发布.</p>
<p><code>Swift</code> 中, <code>Xcode</code> 的每个 <code>target</code> 都被当做独立的模块处理.</p>
<p>如果是为了实现某个通用的功能, 或者是为了封装一些常用方法而将代码打包成独立的框架, 这个框架就是 <code>Swift</code> 中的一个模块. 当它被导入到某个应用程序或者其他框架时, 矿建内容都将属于这个独立的模块.</p>
<p>源文件是 <code>Swift</code> 中国的源文件, 它通常属于一个模块, 即一个应用程序或者框架.</p>
<h2 id="访问级别"><a href="#访问级别" class="headerlink" title="访问级别"></a>访问级别</h2><p><code>Swift</code> 为代码中的实体提供了三种不同的访问级别.</p>
<ul>
<li><code>public</code>: 可以访问同一模块文件中的任何实体, 在模块外也可以通过导入该模块来访问源文件里的所有实体. </li>
<li><code>internal</code>: 可以访问同一模块源文件中的任何实体, 但是不能从模块外访问该模块源文件中的实体. </li>
<li><code>private</code>: 限制实体只能在所在的源文件内部使用.</li>
</ul>
<h2 id="访问级别基本原则"><a href="#访问级别基本原则" class="headerlink" title="访问级别基本原则"></a>访问级别基本原则</h2><p><code>Swift</code> 中的访问级别遵循一个基本原则: 不可以在某个实体中定义访问级别更高的实体.</p>
<p>一个 <code>public</code> 访问级别的变量, 其类型的访问级别不能是 <code>internal</code> 或 <code>private</code>. 因为无法保证变量的类型在使用变量的地方也具有访问权限.</p>
<p>函数的访问级别不能高于它的参数类型和返回类型的访问级别.</p>
<h2 id="默认访问级别"><a href="#默认访问级别" class="headerlink" title="默认访问级别"></a>默认访问级别</h2><p>如果不为代码的实体显式指定访问级别, 那么它们默认为 <code>internal</code> 级别.</p>
<h2 id="单-target-应用程序的访问级别"><a href="#单-target-应用程序的访问级别" class="headerlink" title="单 target 应用程序的访问级别"></a>单 target 应用程序的访问级别</h2><p>当编写一个单 <code>target</code> 应用程序时, 应用的所有功能都是为该应用服务, 而不需要提供给其他应用或者模块使用, 所以我们不需要明确设置访问级别, 使用默认的访问级别 <code>internal</code> 即可.</p>
<h2 id="框架的访问级别"><a href="#框架的访问级别" class="headerlink" title="框架的访问级别"></a>框架的访问级别</h2><p>当开发框架时, 就需要把一些对外的接口定义为 <code>public</code> 级别, 以便使用者导入该框架后可以正常使用其功能. 这些被定义为 <code>public</code> 的接口, 就是这个框架的 <code>API</code>.</p>
<h2 id="党员测试-target-的访问级别"><a href="#党员测试-target-的访问级别" class="headerlink" title="党员测试 target 的访问级别"></a>党员测试 target 的访问级别</h2><p>当应用程序包含单元测试 <code>target</code> 时, 为了测试, 测试模块需要访问应用程序模块中的代码. 默认情况下只有 <code>public</code> 级别的实体才可能被其他模块访问. 而且, 如果在导入应用程序模块的语句前面使用 <code>@testable</code> 特性, 然后在允许测试的编辑设置 (<code>Build Options</code> -&gt; <code>Enable Testability</code>) 下编译这个应用程序模块, 单元测试 <code>target</code> 就可以访问应用程序模块中所有 <code>internal</code> 级别的实体. </p>
<h2 id="访问控制语法"><a href="#访问控制语法" class="headerlink" title="访问控制语法"></a>访问控制语法</h2><p><code>public</code> <code>internal</code> <code>private</code> 来声明实体的访问级别.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SomePublicClass</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeInternalClass</span> </span>&#123;&#125; <span class="comment">// 除非专门制定, 否则实体默认访问级别为 internal</span></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SomePrivateClass</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> somePublicVariable = <span class="number">0</span></span><br><span class="line"><span class="keyword">var</span> someInternalConstant = <span class="number">0</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">somePrivateFunction</span><span class="params">()</span></span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="自定义类型"><a href="#自定义类型" class="headerlink" title="自定义类型"></a>自定义类型</h2><p>如果像为一个自定义类型制定访问级别, 在定义类型时进行制定即可.</p>
<p>一个类型的访问级别也会影响到类型成员的默认访问级别, 如果将类型指定类 <code>private</code> 级别, 那么该类型的所有成员的默认访问级别也会变成 <code>private</code>.</p>
<p>一个 <code>public</code> 类型的所有成员的访问级别默认为 <code>internal</code> 级别, 而不是 <code>public</code> 类型.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SomePublicClass</span> // 显式的 <span class="title">public</span> 类</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> somePublicProperty = <span class="number">0</span> <span class="comment">// 显式的 public 类成员</span></span><br><span class="line">    <span class="keyword">var</span> someInternalProperty = <span class="number">0</span> <span class="comment">// 隐式的 internal 类成员</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">somePrivateMethod</span><span class="params">()</span></span> &#123;&#125; <span class="comment">// 显式的 private 类成员</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeInternalClass</span> // 隐式的 <span class="title">internal</span> 类</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> someInternalProperty = <span class="number">0</span> <span class="comment">// 隐式的 internal 类成员</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">somePrivateMethod</span><span class="params">()</span></span> &#123;&#125; <span class="comment">// 显式的 private 类成员</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SomePrivateClass</span> // 显示的 <span class="title">private</span> 类</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> somePrivateProperty = <span class="number">0</span> <span class="comment">// 隐式的 private 类成员</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">somePrivateMethod</span><span class="params">()</span></span> &#123;&#125; <span class="comment">// 隐式的 private 类成员</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="元组类型"><a href="#元组类型" class="headerlink" title="元组类型"></a>元组类型</h2><p>元组的访问级别将由元组中访问级别最严格的类型来决定</p>
<h2 id="函数类型"><a href="#函数类型" class="headerlink" title="函数类型"></a>函数类型</h2><p>函数的访问级别根据访问级别最严格的参数类型或返回类型的访问级别来决定. 但是, 如果这种访问级别不符合函数定义所在环境的默认访问级别, 那么就需要明确地指定该函数的访问类型</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">someFunction</span><span class="params">()</span></span> -&gt; (<span class="type">SomeInternalClass</span>, <span class="type">SomePrivateClass</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 此处是函数实现部分</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">someFunction</span><span class="params">()</span></span> -&gt; (<span class="type">SomeInternalClass</span>, <span class="type">SomePrivateClass</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 此处是函数实现部分</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="枚举类型"><a href="#枚举类型" class="headerlink" title="枚举类型"></a>枚举类型</h2><p>枚举成员的访问级别和该枚举类型相同, 你不能为枚举成员单独指定不同的访问级别.</p>
<p>枚举定义中的任何原始值或关联值的访问级别至少不能低于该枚举类型的访问级别. 例如, 不能在一个 <code>internal</code> 访问级别的枚举中定义 <code>private</code> 级别的原始值类型.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">CompassPoint</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">North</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">Sourth</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">East</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">West</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="嵌套类型"><a href="#嵌套类型" class="headerlink" title="嵌套类型"></a>嵌套类型</h2><ul>
<li>如果在 <code>private</code> 级别的类型中定义嵌套类型, 那么该嵌套类型就自动拥有 <code>private</code> 访问级别.</li>
<li>如果在 <code>public</code> 或者 <code>internal</code> 级别的类型中定义嵌套类型, 那么该嵌套类型自动拥有 <code>internal</code> 访问级别.</li>
</ul>
<h2 id="子类"><a href="#子类" class="headerlink" title="子类"></a>子类</h2><p>子类的访问级别不得高于父类的访问级别. 例如, 父类的访问级别是 <code>internal</code>, 子类的访问级别不能是 <code>public</code> .</p>
<p>可以通过重写为继承来的类成员提供更高的访问级别.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">someMethod</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span>: <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">internal</span> <span class="function"><span class="keyword">func</span> <span class="title">someMethod</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">someMethod</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span>: <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">internal</span> <span class="function"><span class="keyword">func</span> <span class="title">someMethod</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.someMethod()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="常量-变量-属性-下标"><a href="#常量-变量-属性-下标" class="headerlink" title="常量 变量 属性 下标"></a>常量 变量 属性 下标</h2><p>常量 变量 属性 不能拥有比它们类型更高的访问级别.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> privateInstance = <span class="type">SomePrivateClass</span>()</span><br></pre></td></tr></table></figure>
<h2 id="Getter-和-Setter"><a href="#Getter-和-Setter" class="headerlink" title="Getter 和 Setter"></a>Getter 和 Setter</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TrackedString</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span>(<span class="keyword">set</span>) <span class="keyword">var</span> numberOfEdites = <span class="number">0</span> <span class="comment">// Setter 的访问级别可以低于对应的 Getter 的访问级别, 这样就可以公职变量 属性或下标的读写权限</span></span><br><span class="line">    <span class="keyword">var</span> value: <span class="type">String</span> = <span class="string">""</span> &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            numberOfEdites++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">TranckedString</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">private</span>(<span class="keyword">set</span>) <span class="keyword">var</span> numberOfEdits = <span class="number">0</span> <span class="comment">// 可以在必要时为 Getter 和 Setter 显式指定访问级别.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> value: <span class="type">String</span> = <span class="string">""</span> &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            numberOfEdits++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="构造器"><a href="#构造器" class="headerlink" title="构造器"></a>构造器</h2><ul>
<li>自定义构造器的访问级别可以低于或等于其所属类型的访问级别</li>
<li>唯一例外的是必要构造器, 它的访问级别必须和所属类型的访问级别相同.</li>
<li>如同函数或访问的参数, 构造器参数的访问权限也不能低于构造器本身的访问级别.</li>
</ul>
<h2 id="默认构造器"><a href="#默认构造器" class="headerlink" title="默认构造器"></a>默认构造器</h2><p>默认构造器的访问级别与所属类型的访问级别相同, 除非类型的访问级别是 <code>public</code></p>
<h2 id="构造体默认的成员逐一构造器"><a href="#构造体默认的成员逐一构造器" class="headerlink" title="构造体默认的成员逐一构造器"></a>构造体默认的成员逐一构造器</h2><p>如果构造体中任意储存性属性的访问级别为 <code>private</code> , 那么该构造体默认的成员逐一构造器的访问级别就是 <code>private</code>. 否则, 这种构造器的访问级别依然是 <code>internal</code> </p>
<h2 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h2><p>如果定义了一个集成自其它协议的新协议, 那么新协议拥有的访问级别最高也只能和被集成协议的访问级别相同.</p>
<h2 id="协议一致性"><a href="#协议一致性" class="headerlink" title="协议一致性"></a>协议一致性</h2><ul>
<li>一个协议可以采纳比自身访问级别低的协议.</li>
<li>采纳了协议的类型的访问级别取它本身和所采纳协议两者间最低的访问级别.</li>
<li>如果采纳了协议, 那么实现了协议的所有要求后, 必须确保这些实现的访问级别不能低于协议的访问级别.</li>
</ul>
<h2 id="扩张"><a href="#扩张" class="headerlink" title="扩张"></a>扩张</h2><ul>
<li>可以在访问级别允许的情况下对类 结构体 枚举进行扩展.</li>
<li>扩展成员具有和原始类型成员一致的访问类型.</li>
<li>可以明确指定扩展的访问级别, 从而给该扩展中的所有成员指定一个新的默认访问级别. 这个新的访问级别仍然可以被单独指定的访问级别所覆盖.</li>
</ul>
<h2 id="通过扩展添加协议一致性"><a href="#通过扩展添加协议一致性" class="headerlink" title="通过扩展添加协议一致性"></a>通过扩展添加协议一致性</h2><p>如果通过扩展来采纳协议, 那么就不能显式指定该扩展的访问级别, 协议拥有相应的访问级别, 并会为该扩展中所有协议要求的实现提供默认的访问级别.</p>
<h2 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h2><p>泛型类型或泛型函数的访问级别取决于泛型类型或泛型函数本身的访问级别, 还需要结合类型参数的类型约束的访问级别, 根据这些访问级别中的最低访问级别来确定.</p>
<h2 id="类型别名"><a href="#类型别名" class="headerlink" title="类型别名"></a>类型别名</h2><p>定义的任何类型别名都会被当做不同的类型.</p>
<p>类型别名的访问级别不可高于其表现类型的访问级别.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/icon.jpg"
                alt="ZeroJi" />
            
              <p class="site-author-name" itemprop="name">ZeroJi</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">49</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ZeroJi</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.4"></script>


  

</body>
</html>
